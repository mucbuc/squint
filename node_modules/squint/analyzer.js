var namespaceDeclare = new RegExp( 'namespace\\s*\\w*\\s*', 'g' )
  , namespaceDeclarator = new RegExp( 'namespace\\s*', 'g' )
  , typeDeclare = new RegExp( '\\w+' )
  , typeDeclarator = new RegExp( '(.*)\\s*(class|struct)\\s+(\\w+)' )
  , templateHeader = new RegExp( '\\s*template' )
  , Parser = require( 'squint/parser' ).Parser;
  
function Analyzer(emitter) {
  emitter.on( 'open', function( code ) {
  
    var parser = new Parser( { 
          '(': 'open function', 
          ')': 'close function',
          '<': 'open template', 
          '>': 'close template' 
        } )
      , templateParams = { code: '', depth: 0 }
      , functionParams = { code: '', depth: 0 };
    
    parser.on( 'open template', function( code ) {
      templateParams.code += code + '<';
      ++templateParams.depth;
    } );
    
    parser.on( 'close template', function() { 
      templateParams.code += '>';
      if (!--templateParams.depth) {
        emitter.emit( 'template', templateParams.code );
      }
    } );
    
    parser.on( 'open function', function( code ) {
      functionParams.code += code + '(';
      ++functionParams.depth;
    } ); 
    
    parser.on( 'close function', function() {
      functionParams.code += ')';
      if (!--functionParams.depth) {
        emitter.emit( 'function', functionParams.code );
      }
    } ); 
    
    parser.process( code );

  } );
}

module.exports.Analyzer = Analyzer; 
